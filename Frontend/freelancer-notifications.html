<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications | Nutzy Craft</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
    <script src="config.js"></script>
    <script src="script.js" defer></script>
</head>

<body>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <a href="index.html" class="sidebar-logo">
                <img src="logo.jpg" alt="Logo" style="width: 40px; border-radius: 50%;">
                Nutzy Craft
            </a>

            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="freelancer-dashboard.html" class="sidebar-link">
                        <i class="fa-solid fa-grid-2"></i> Dashboard
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="freelancer-my-profile.html" class="sidebar-link">
                        <i class="fa-solid fa-user"></i> My Profile
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="find-jobs.html" class="sidebar-link">
                        <i class="fa-solid fa-briefcase"></i> Browse Jobs
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="my-proposals.html" class="sidebar-link">
                        <i class="fa-solid fa-file-invoice-dollar"></i> My Proposals
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="messages.html" class="sidebar-link">
                        <i class="fa-solid fa-message"></i> Messages
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="earnings.html" class="sidebar-link">
                        <i class="fa-solid fa-wallet"></i> Earnings
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="settings.html" class="sidebar-link">
                        <i class="fa-solid fa-gear"></i> Settings
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="freelancer-support.html" class="sidebar-link">
                        <i class="fa-solid fa-headset"></i> Support
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="dashboard-topbar">
                <button class="sidebar-toggle-btn"><i class="fa-solid fa-bars"></i></button>
                <div>
                    <h2 class="dashboard-title" style="font-size: 1.5rem;">Notifications</h2>
                    <p style="color: #666;">Stay updated with your latest activities.</p>
                </div>
            </div>

            <div class="glass-card table-responsive" style="padding: 0;">
                <div id="notifications-list" style="padding: 20px;">
                    <div style="text-align: center; color: #888;">Loading notifications...</div>
                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', async () => {
                    const email = localStorage.getItem('loggedInEmail') || sessionStorage.getItem('loggedInEmail');
                    const listContainer = document.getElementById('notifications-list');

                    if (!email) {
                        listContainer.innerHTML = '<div style="text-align: center; color: #888;">Please login to view notifications.</div>';
                        return;
                    }

                    try {
                        const response = await fetch(`${window.API_CONFIG.BASE_URL}/api/notifications?email=${encodeURIComponent(email)}`);
                        if (response.ok) {
                            const notifications = await response.json();

                            if (notifications.length === 0) {
                                listContainer.innerHTML = '<div style="text-align: center; color: #888;">No new notifications.</div>';
                                return;
                            }

                            listContainer.innerHTML = notifications.map(n => `
                                <div style="display: flex; gap: 15px; padding: 15px; border-bottom: 1px solid #f0f0f0; align-items: start; background: ${n.read ? 'transparent' : '#f9fafb'};">
                                    <div style="background: ${n.type === 'ERROR' ? '#ffebee' : '#e3f2fd'}; color: ${n.type === 'ERROR' ? '#d32f2f' : '#1976d2'}; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fa-solid ${n.type === 'ERROR' ? 'fa-triangle-exclamation' : 'fa-bell'}"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; margin-bottom: 5px;">${n.title}</div>
                                        <div style="color: #555; font-size: 0.95rem;">${n.message}</div>
                                        <div style="color: #999; font-size: 0.8rem; margin-top: 5px;">${new Date(n.createdAt).toLocaleDateString()} ${new Date(n.createdAt).toLocaleTimeString()}</div>
                                        ${n.link ? `<div style="margin-top: 10px;"><a href="${n.link}" class="btn btn-outline" style="padding: 4px 10px; font-size: 0.75rem;">View Details</a></div>` : ''}
                                    </div>
                                    ${!n.read ? `<button onclick="markAsRead(${n.id}, this)" class="btn btn-outline" style="padding: 4px 10px; font-size: 0.75rem;">Mark Read</button>` : ''}
                                </div>
                            `).join('');
                        } else {
                            listContainer.innerHTML = '<div style="text-align: center; color: #888;">Failed to load notifications.</div>';
                        }
                    } catch (e) {
                        console.error(e);
                        listContainer.innerHTML = '<div style="text-align: center; color: #888;">An error occurred.</div>';
                    }

                    window.markAsRead = async (id, btn) => {
                        try {
                            await fetch(`${window.API_CONFIG.BASE_URL}/api/notifications/${id}/read`, { method: 'POST' });
                            btn.remove();
                            // Optional: reload or style update
                        } catch (e) { console.error(e); }
                    };
                });
            </script>
        </main>
    </div>
</body>

</html>