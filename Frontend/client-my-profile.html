<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile | Nutzy Craft</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="profile.css"> <!-- Reusing profile css -->
    <script src="config.js"></script>
    <script src="script.js" defer></script>
    <style>
        .edit-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
            color: white;
            font-weight: 600;
        }

        .editable-container:hover .edit-overlay {
            opacity: 1;
        }

        .edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            color: var(--primary);
            z-index: 10;
        }
    </style>
</head>

<body>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <a href="index.html" class="sidebar-logo">
                <img src="logo.jpg" alt="Logo" style="width: 40px; border-radius: 50%;">
                Nutzy Craft
            </a>

            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="client-dashboard.html" class="sidebar-link">
                        <i class="fa-solid fa-grid-2"></i> Dashboard
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-my-profile.html" class="sidebar-link active">
                        <i class="fa-solid fa-user"></i> My Profile
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="post-job.html" class="sidebar-link">
                        <i class="fa-solid fa-plus-circle"></i> Post a Job
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-my-jobs.html" class="sidebar-link">
                        <i class="fa-solid fa-briefcase"></i> My Jobs
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="find-freelancer.html" class="sidebar-link">
                        <i class="fa-solid fa-users"></i> Find Freelancers
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-messages.html" class="sidebar-link">
                        <i class="fa-solid fa-message"></i> Messages
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-settings.html" class="sidebar-link">
                        <i class="fa-solid fa-gear"></i> Settings
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="client-support.html" class="sidebar-link">
                        <i class="fa-solid fa-headset"></i> Support
                    </a>
                </li>
            </ul>

            <div class="sidebar-user">
                <img src="https://ui-avatars.com/api/?name=User&background=D4B69D&color=fff"
                    style="width: 40px; height: 40px; border-radius: 50%;">
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 0.9rem;">&nbsp;</div>
                    <div style="font-size: 0.8rem; color: #888;">&nbsp;</div>
                </div>
                <a href="logout.html" style="color: #888;"><i class="fa-solid fa-sign-out-alt"></i></a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="dashboard-topbar">
                <button class="sidebar-toggle-btn"><i class="fa-solid fa-bars"></i></button>
                <div style="flex: 1;">
                    <h2 class="dashboard-title" style="font-size: 1.5rem;">My Client Profile</h2>
                    <p style="color: #666;">This is how freelancers see your company.</p>
                </div>
            </div>

            <div class="profile-container" style="padding: 0; margin: 0; width: 100%;">

                <!-- 1. Profile Header -->
                <div class="glass-card profile-header-card editable-container"
                    style="position: relative; overflow: hidden; min-height: 250px;">
                    <div class="profile-banner"
                        style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); height: 150px;">
                    </div>
                    <div class="profile-header-content" style="padding: 0 30px 30px 30px; margin-top: -50px;">
                        <div class="editable-container"
                            style="position: relative; width: fit-content; margin-bottom: 15px;">
                            <img src="https://ui-avatars.com/api/?name=Client&background=D4B69D&color=fff&size=200"
                                alt="Client" class="profile-avatar-large" id="profile-avatar"
                                style="border: 4px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        </div>

                        <div class="profile-info">
                            <div class="profile-name-row">
                                <h1 class="profile-name" id="display-name">Company Name <i class="fa-solid fa-pen"
                                        style="font-size: 0.9rem; color: #ccc; cursor: pointer;"
                                        onclick="window.location.href='client-settings.html'"></i></h1>
                                <div class="badge-verified"><i class="fa-solid fa-check"></i></div>
                            </div>
                            <p class="profile-title" id="display-industry">Industry <i class="fa-solid fa-pen"
                                    style="font-size: 0.8rem; color: #ccc; cursor: pointer;"
                                    onclick="window.location.href='client-settings.html'"></i></p>

                            <div class="profile-meta" style="margin-top: 10px;">
                                <div class="meta-item"><i class="fa-solid fa-location-dot"></i> <span
                                        id="display-location">-</span></div>
                                <div class="meta-item"><i class="fa-solid fa-globe"></i> <span
                                        id="display-website">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="profile-grid-layout"
                    style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- Left Column -->
                    <div class="profile-main">
                        <!-- About Company -->
                        <div class="glass-card profile-section editable-container" style="position: relative;">
                            <div class="edit-btn" onclick="window.location.href='client-settings.html'"><i
                                    class="fa-solid fa-pen"></i></div>
                            <h3 class="section-title"><i class="fa-solid fa-building"></i> About Company</h3>
                            <p id="display-description" style="color: var(--text-muted); line-height: 1.8;">
                                No description added yet.
                            </p>
                        </div>

                        <!-- Open Jobs -->
                        <div class="glass-card profile-section">
                            <h3 class="section-title"><i class="fa-solid fa-briefcase"></i> Active Job Postings</h3>
                            <p style="color: #888; font-style: italic;">Jobs you post will appear here.</p>
                            <div id="jobs-container" style="margin-top: 15px;">
                                <!-- Job cards would go here -->
                            </div>
                            <a href="post-job.html" class="btn btn-outline"
                                style="margin-top: 15px; display: inline-block;">+ Post a Job</a>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="profile-sidebar">
                        <div class="glass-card profile-section">
                            <h3 class="section-title">Client Stats</h3>
                            <ul style="list-style: none; padding: 0; color: #555;">
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between;">
                                    <span>Total Hires:</span> <strong id="stat-hires">-</strong>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; justify-content: space-between;">
                                    <span>Total Spent:</span> <strong id="stat-spent">-</strong>
                                </li>
                                <li style="display: flex; justify-content: space-between;">
                                    <span>Member Since:</span> <strong>2025</strong>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const email = localStorage.getItem('loggedInEmail') || sessionStorage.getItem('loggedInEmail');

            if (!email) {
                window.location.href = 'login.html';
                return;
            }

            // Fetch Client Profile
            // Fetch Client Profile
            fetch(`${window.API_CONFIG.BASE_URL}/api/clients/me?email=${email}`)
                .then(res => res.json())
                .then(data => {
                    // Check if response is DTO or direct Entity (fallback)
                    const client = data.client || data;
                    const stats = {
                        hires: data.totalHires !== undefined ? data.totalHires : '-',
                        spent: data.totalSpent !== undefined ? data.totalSpent : '-',
                        since: data.memberSince !== undefined ? data.memberSince : '2025'
                    };

                    const user = client.user || {};

                    // Header
                    let displayName = client.companyName;
                    if (displayName === 'Freelancer Inc') displayName = null;
                    displayName = displayName || client.contactPerson || user.fullName || 'Client';

                    document.getElementById('display-name').innerHTML = `${displayName} <i class="fa-solid fa-pen" style="font-size: 0.9rem; color: #ccc; cursor: pointer;" onclick="window.location.href='client-settings.html'"></i>`;
                    document.getElementById('display-industry').innerHTML = `${client.industry || 'General'} <i class="fa-solid fa-pen" style="font-size: 0.8rem; color: #ccc; cursor: pointer;" onclick="window.location.href='client-settings.html'"></i>`;

                    // Avatar
                    if (client.profileImage) {
                        document.getElementById('profile-avatar').src = client.profileImage;
                    } else {
                        const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.fullName || 'Client')}&background=D4B69D&color=fff&size=200`;
                        document.getElementById('profile-avatar').src = avatarUrl;
                    }

                    // Background Banner
                    if (client.bannerImage) {
                        document.querySelector('.profile-banner').style.background = `url('${client.bannerImage}') center/cover no-repeat`;
                    }

                    // Meta
                    document.getElementById('display-location').textContent = client.billingAddress || 'Location not set';
                    document.getElementById('display-website').innerHTML = client.website ? `<a href="${client.website}" target="_blank" style="color: var(--primary);">${client.website}</a>` : 'No website';

                    // Description
                    document.getElementById('display-description').innerText = client.description || 'No description provided.';

                    // Stats Population
                    document.getElementById('stat-hires').textContent = stats.hires;
                    document.getElementById('stat-spent').textContent = stats.spent !== '-' ? `$${stats.spent.toFixed(2)}` : '-';

                    // Display Rating
                    const rating = data.rating || 0;
                    const stars = Array(5).fill(0).map((_, i) =>
                        `<i class="fa-${i < Math.round(rating) ? 'solid' : 'regular'} fa-star" style="color: #ffc107;"></i>`
                    ).join('');

                    let ratingContainer = document.getElementById('client-rating-display');
                    if (!ratingContainer) {
                        const parent = document.querySelector('.profile-info');
                        ratingContainer = document.createElement('div');
                        ratingContainer.id = 'client-rating-display';
                        ratingContainer.style.marginTop = '10px';
                        parent.appendChild(ratingContainer);
                    }
                    ratingContainer.innerHTML = `${stars} <span style="color: #666; font-size: 0.9rem;">(${rating.toFixed(1)})</span>`;

                })
                .catch(err => console.error(err));
        });
    </script>
</body>

</html>